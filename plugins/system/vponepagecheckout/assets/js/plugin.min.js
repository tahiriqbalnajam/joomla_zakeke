/**
 * @package      VP One Page Checkout - Joomla! System Plugin
 * @subpackage   For VirtueMart 3+ and VirtueMart 4+
 *
 * @copyright    Copyright (C) 2012-2024 Virtueplanet Services LLP. All rights reserved.
 * @license      GNU General Public License version 2 or later; see LICENSE.txt
 * @authors      Abhishek Das <info@virtueplanet.com>
 * @link         https://www.virtueplanet.com
 */
var VPOPC=window.VPOPC||{},ProOPC=window.ProOPC||{};ProOPC.jQuery=jQuery.noConflict(),function(a,t,o,d,p){p.ajaxPool={},p.cache={},d.options={},p.on_load_bt_country_id=null,p.on_load_st_country_id=null,d.loadOptions=function(e){if(!e){for(var o,s,p,n=document.querySelectorAll(".vpopc-script-options.new"),c=0,m=n.length;c<m;c++)s=n[c],o=s.text||s.textContent,p=JSON.parse(o),p?d.loadOptions(p):null,s.className=s.className.replace(" new"," loaded");return}if(a.isEmptyObject(d.options))for(var l in e)this.options[l]=e[l];else for(var l in e)e.hasOwnProperty(l)&&(this.options[l]=e[l]);return this},d.setOption=function(e,t){this.options[e]=t},d._=function(o,e){return a.isEmptyObject(d.options)&&d.loadOptions(),e="undefined"!=typeof e&&e,typeof this.options[o.toUpperCase()]=="undefined"?e:this.options[o.toUpperCase()]},d.JText={strings:{},_:function(o,e){return a.isEmptyObject(this.strings)&&this.load(),e="undefined"==typeof e?null:e,typeof this.strings[o.toUpperCase()]=="undefined"?e:this.strings[o.toUpperCase()]},sprintf:function(o,e){a.isEmptyObject(this.strings)&&this.load(),e=typeof e==typeof void 0?"":e;var i=typeof this.strings[o.toUpperCase()]==typeof void 0?"":this.strings[o.toUpperCase()];return i.replace("%s",e)},plural:function(e,t){if(a.isEmptyObject(this.strings)&&this.load(),!e)return"";t=typeof t=="undefined"?0:parseInt(t),1>=t&&(e+="_1");var o=typeof this.strings[e.toUpperCase()]=="undefined"?"":this.strings[e.toUpperCase()];return o.replace("%s",t)},load:function(o){if(!o){for(var e,s,p,n=document.querySelectorAll(".vpopc-script-strings.new"),c=0,m=n.length;c<m;c++)s=n[c],e=s.text||s.textContent,p=JSON.parse(e),p?d.JText.load(p):null,s.className=s.className.replace(" new"," loaded");return}if(a.isEmptyObject(this.strings))for(var l in o)this.strings[l.toUpperCase()]=o[l];else for(var l in o)o.hasOwnProperty(l)&&(this.strings[l.toUpperCase()]=o[l]);return this}},p.init=function(e){if(e=p.hasValue(e),e&&navigator.userAgent.match(/IEMobile\/10\.0/)){var t=document.createElement("style");t.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(t)}e&&p._init(),a("#ProOPC .proopc-btn").each(function(){var t=a(this).attr("onclick"),o=a(this).attr("id"),o=o?a.trim(o):"",i=a(this).data("proopcReady");t&&0<=t.indexOf("ProOPC.")&&!i&&(a(this).click(function(a){return(a.preventDefault(),0<=t.indexOf("updateproductqty"))?p.updateproductqty(this):0<=t.indexOf("deleteproduct")?p.deleteproduct(this):0<=t.indexOf("guestcheckout")?p.guestcheckout(this):0<=t.indexOf("registerCheckout")?p.registerCheckout(this):0<=t.indexOf("loginAjax")?p.loginAjax(this):0<=t.indexOf("submitOrder")?p.submitOrder(this):0<=t.indexOf("savecoupon")?p.savecoupon(this):void 0}).data("proopcReady",!0).removeAttr("onclick"),(e||0>t.indexOf("submitOrder"))&&a(this).removeAttr("disabled"),i=a(this).data("proopcReady")),"proopc-task-guestcheckout"!=o||i?"proopc-task-registercheckout"!=o||i?"proopc-task-loginajax"!=o||i?"proopc-order-submit"!=o||i?"proopc-task-savecoupon"!=o||i?a(this).hasClass("proopc-task-updateqty")&&!i?a(this).click(function(t){return t.preventDefault(),p.updateproductqty(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).hasClass("proopc-task-deleteproduct")&&!i&&a(this).click(function(t){return t.preventDefault(),p.deleteproduct(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).click(function(t){return t.preventDefault(),p.savecoupon(this)}).data("proopcReady",!0).removeAttr("disabled"):(a(this).click(function(t){return t.preventDefault(),p.submitOrder(this)}).data("proopcReady",!0),e&&a(this).removeAttr("disabled")):a(this).click(function(t){return t.preventDefault(),p.loginAjax(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).click(function(t){return t.preventDefault(),p.registerCheckout(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).click(function(t){return t.preventDefault(),p.guestcheckout(this)}).data("proopcReady",!0).removeAttr("disabled")});var o,i,s=a("form#EditBTAddres"),n=a("form#EditSTAddres"),l=a("form#proopc-shipment-form"),c=a("form#proopc-payment-form");a("select#virtuemart_state_id",s).attr("id","virtuemart_state_id_field"),a("select#shipto_virtuemart_state_id",n).attr("id","shipto_virtuemart_state_id_field"),a("#city_field, #zip_field, #virtuemart_country_id_field, #virtuemart_state_id_field",s).each(function(){a(this).data("proopcReady")||(p.on_load_bt_country_id=a("#virtuemart_country_id_field",s).val(),a(this).change(function(){p.updateBTaddress(this)}).data("proopcReady",!0)),o=a(this).attr("onchange"),o&&0<=o.indexOf("ProOPC")&&a(this).removeAttr("onchange")}),a("#shipto_city_field, #shipto_zip_field, #shipto_virtuemart_country_id_field, #shipto_virtuemart_state_id_field",n).each(function(){a(this).data("proopcReady")||(p.on_load_st_country_id=a("#shipto_virtuemart_country_id_field",n).val(),a(this).change(function(){p.updateSTaddress(this)}).data("proopcReady",!0)),o=a(this).attr("onchange"),o&&0<=o.indexOf("ProOPC")&&a(this).removeAttr("onchange")}),a("select#virtuemart_state_id_field, select#shipto_virtuemart_state_id_field").each(function(){(a(this).hasClass("required")||a(this).attr("required"))&&!1!==a(this).data("frequired")?a(this).data("frequired",!0):!0!==a(this).data("frequired")&&a(this).data("frequired",!1)}),a("select#proopc-select-st",n).each(function(){a(this).data("proopcReady")||a(this).change(function(){p.selectSTAddress(this)}).data("proopcReady",!0),o=a(this).attr("onchange"),o&&0<=o.indexOf("ProOPC")&&a(this).removeAttr("onchange")}),a("input[name=\"virtuemart_shipmentmethod_id\"][type=\"radio\"]",l).each(function(){a(this).data("proopcReady")||a(this).click(function(){return p.setshipment(this)}).data("proopcReady",!0),i=a(this).attr("onclick"),i&&0<=i.indexOf("ProOPC")&&a(this).removeAttr("onclick")}),a("input[name=\"virtuemart_paymentmethod_id\"][type=\"radio\"]",c).each(function(){a(this).data("proopcReady")||a(this).click(function(){return p.setpayment(this)}).data("proopcReady",!0),i=a(this).attr("onclick"),i&&0<=i.indexOf("ProOPC")&&a(this).removeAttr("onclick")}),a("select",l).each(function(){var e=a(this).closest("fieldset");e.length&&a(this).width(e.width()),a(this).data("proopcReady")||a(this).change(function(){var e=a("form#proopc-shipment-form").find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked");e.length&&p.setshipment(e)}).data("proopcReady",!0)}),a("select",c).each(function(){a(this).data("proopcReady")||a(this).change(function(){var e=a("form#proopc-payment-form").find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked"),t=e.data("pmtype");e.length&&t&&0<=a.inArray(t,["sisowideal","buckaroo","piraeus"])&&p.setpayment(e)}).data("proopcReady",!0)});var m=a("input[name=\"proopc-method\"][type=\"radio\"]");m.length&&!m.data("proopcReady")&&m.change(function(){p.opcmethod()}).removeAttr("onchange").data("proopcReady",!0);var u=d._("BT_UPDATE_FIELDS"),_=d._("ST_UPDATE_FIELDS");u&&"array"===a.type(u)&&a.each(u,function(e,t){if(t){var o=a("[name=\""+t+"\"]",s);o.length&&!o.data("proopcReady")&&o.change(function(){p.updateBTaddress(this)}).data("proopcReady",!0)}}),_&&"array"===a.type(_)&&a.each(_,function(e,t){if(t){var o=a("[name=\""+t+"\"]",n);o.length&&!o.data("proopcReady")&&o.change(function(){p.updateSTaddress(this)}).data("proopcReady",!0)}}),a("input.datepicker-db:hidden").each(function(){if(!a(this).data("proopcDateReady")){var e=this,t=a(e).data("dateInterval");t&&clearInterval(t),t=setInterval(function(){a(e).val()!=a(e).data("oldValue")&&a(e).data("oldValue",a(e).val()).trigger("change")},200),a(e).data("dateInterval",t).data("proopcDateReady",!0)}}),a("#ProOPC [data-quantity]").each(function(){a(this).data("proopcReady")||a(this).on("change",p.bindQuantityChange).data("proopcReady",!0)}),a("#ProOPC [data-clearcart]").each(function(){a(this).data("proopcReady")||a(this).on("click",p.clearCart).data("proopcReady",!0)})},p._init=function(){if("function"!=typeof window.atob)return!0;p.ajax("test",{success:function(e){if("object"==typeof e&&typeof e.manifest!="undefined"){var t=a.parseXML(e.manifest),o=a(t),i=window.atob("bGl2ZXVwZGF0ZQ=="),s=o.find(i),p=s.text(),n=window.atob("ZG93bmxvYWRfa2V5"),l=window.atob("cmVxdWlyZWQ=");s.length?0<=p&&o.find("config").find("field").each(function(){a(this).attr("name")==n&&"true"!==a(this).attr(l)&&d.setOption("ALL_OKAY",!1)}):d.setOption("ALL_OKAY",!1)}}});var e=document.querySelector("#checkoutFormSubmit");if(e){var t=new MutationObserver(()=>{var t=empty(e.textContent)||"0"==e.textContent?null:e.textContent;t&&a(".proopc-order-confirmation-notice").text(t),e.disabled&&t&&t!==e.getAttribute("data-dvalue")?(a(".proopc-confirm-button-wrapper").addClass("disable-button"),a(".proopc-order-confirmation-notice").removeClass("hide")):(a(".proopc-confirm-button-wrapper").removeClass("disable-button"),a(".proopc-order-confirmation-notice").addClass("hide"))});t.observe(e,{attributes:!0,subtree:!0,childList:!0,characterData:!0})}return!0},p.initSpinner=function(){p.cache.spinner=p.cache.spinner||new VPSpinner({lines:13,length:3,width:2,radius:5,corners:1,rotate:0,direction:1,color:"#FFF",speed:1.5,trail:60,shadow:!1,hwaccel:!1,className:"proopc-spinner",zIndex:2e9,top:"auto",left:"auto"}).spin();var e={lines:10,length:10,width:4,radius:15,corners:1,rotate:0,direction:1,color:d._("SPINNER_COLOR"),speed:1.5,trail:60,shadow:!1,hwaccel:!0,className:"proopc-page-loader",zIndex:2e9,top:20,left:14};p.cache.loader=p.cache.loader||new VPSpinner(e).spin();var t={lines:10,length:5,width:3,radius:8,corners:1,rotate:0,direction:1,color:d._("SPINNER_COLOR"),speed:1.5,trail:40,shadow:!1,hwaccel:!0,className:"proopc-area-loader",zIndex:2e9,top:20,left:14};p.cache.area_loader=p.cache.area_loader||new VPSpinner(t).spin()},p.ajaxManager=function(){var o=[],i=!1,s=!1;return{tid:null,opt:{type:"POST",dataType:"JSON",url:null,cache:!1},setContinuous:function(e){i=!!e},isRunning:function(){return s},addReq:function(e,t){e.opcTask=t?t:null,o.push(e)},removeReq:function(e){-1<a.inArray(e,o)&&o.splice(a.inArray(e,o),1)},run:function(){var p,l,c,m=this,u=i?500:1e3;s=!0,o.length?(p=o[0].hasOwnProperty("complete")?o[0].complete:null,l=o[0].hasOwnProperty("error")?o[0].error:null,c=o[0].hasOwnProperty("opcTask")&&typeof o[0].opcTask!=typeof void 0&&o[0].opcTask?"ajaxManager task "+o[0].opcTask+".":"ajaxManager.",o[0].url=o[0].hasOwnProperty("url")?o[0].url:d._("URI"),o[0]=a.extend(!0,{},m.opt,o[0]),o[0].complete=function(a,e){"function"==typeof p&&p.call(this,a,e),o.shift(),m.run.apply(m,[])},o[0].error=function(a,e,t){"function"==typeof l&&l.call(this,a,e,t),console.warn("Ajax error is generated running "+c),e&&"abort"!=e&&t&&"abort"!=t&&(console.log(a),"parsererror"==e&&a.responseText&&console.log(a.responseText),console.log(e),console.log(t))},a.ajax(o[0])):m.tid=setTimeout(function(){m.run.apply(m,[])},u)},stop:function(){o=[],this.tid&&clearTimeout(this.tid),s=!1}}}(),p.opcmethod=function(){var t=a("input[type=\"radio\"][name=\"proopc-method\"]:checked").val();"guest"==t?(a(".proopc-reg-form, .proopc-login-form").addClass("soft-hide").css("opacity",0),a(".proopc-reg-advantages, .proopc-guest-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){a(".proopc-reg-advantages, .proopc-guest-form").animate({opacity:1},500),p.inputwidth(),p.selectwidth()},50)):"login"==t?(a(".proopc-reg-form, .proopc-reg-advantages, .proopc-guest-form").addClass("soft-hide").css("opacity",0),a(".proopc-login-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){a(".proopc-login-form").animate({opacity:1},500),p.inputwidth(),p.selectwidth()},50)):(a(".proopc-reg-advantages, .proopc-guest-form, .proopc-login-form").addClass("soft-hide").css("opacity",0),a(".proopc-reg-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){a(".proopc-reg-form").animate({opacity:1},500,function(){a("#UserRegistration #dynamic_recaptcha_1").length&&p.setStyle()}),p.inputwidth(),p.selectwidth()},50))},p._updateFieldState=function(e,t,o){var i=a(this).siblings(".status");e?(a(this).removeClass("invalid").addClass("valid").removeClass("hasFieldTip").removeAttr("title"),i.removeClass("invalid").removeClass("validating"),p.hasValue(t)&&i.addClass("valid")):null===e?(a(this).removeClass("valid").removeClass("invalid"),i.removeClass("invalid").removeClass("valid").addClass("validating")):(a(this).removeClass("valid").addClass("invalid"),i.addClass("invalid").removeClass("valid").removeClass("validating")),p.hasValue(o)?i.attr("title",d.JText._(o)):i.removeAttr("title"),p.tooltip()},p.hasValue=function(e){return!!(typeof e!=typeof void 0&&e&&"0"!=e)&&e},p._checkAjaxPool=function(e){p.hasValue(e)&&p.ajaxPool.hasOwnProperty(e)&&4!=p.ajaxPool[e].readystate&&p.ajaxPool[e].abort()},p._triggerEvent=function(e){e=p.hasValue(e)&&"string"===a.type(e)?[e]:e,a(o).trigger("vpopc.event",e)},p._reload=function(){var e=a("form#proopc-reload-form");e.length?e.submit():p._reload()},p.ajax=function(o,i){o=p.hasValue(o)?o:"dummy";var s={type:"POST",dataType:"JSON",url:d._("URI"),data:"ctask="+o,cache:!1,async:!0,error:function(s,e,t){"abort"!=e&&"abort"!=t&&(console.warn("Ajax error is generated executing ctask "+o+"."),"parsererror"==e&&s.responseText&&console.log(s.responseText),console.log(s),console.log(e),console.log(t)),typeof i.errorCallback!="undefined"&&"function"==a.type(i.errorCallback)&&i.errorCallback.call(this)}};return i=a.extend(!0,{},s,i),p._checkAjaxPool(o),p.ajaxPool[o]=a.ajax(i),p.ajaxPool[o]},p.bindFormValidator=function(){var e=a("form#UserLogin"),t=a("form#GuestUser"),o=a("form#UserRegistration");a("input[type=\"text\"]:not(#proopc-secretkey), input[type=\"password\"], input[type=\"email\"]",e).on("change blur keyup",function(){a(this).val()?p._updateFieldState.call(this,!0,!1):p._updateFieldState.call(this,!1,!1,"PLG_VPONEPAGECHECKOUT_REQUIRED_FIELD")}),a("input[type=\"text\"], input[type=\"email\"]",t).on("change blur keyup",function(){if("email_field"!=a(this).attr("id")&&"guest_email_field"!=a(this).attr("id"))return!1;var e=a(this).val();e&&e.length&&(e=a.trim(e),a(this).val(e)),p.validateEmail(e)?p._updateFieldState.call(this,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):p._updateFieldState.call(this,!1,!0,"PLG_VPONEPAGECHECKOUT_EMAIL_INVALID")}),a("input[type=\"text\"], input[type=\"email\"], input[type=\"password\"], input[type=\"checkbox\"], input[type=\"radio\"], select, textarea",o).on("change blur keyup",function(){var t=this,o=a(this).closest("form"),i=a(this).parent(".proopc-input"),s=a(t).attr("required")||a(t).hasClass("required"),n=a(t).attr("id"),l=a(t).val(),c=a(t).attr("type");if(!s&&!i.data("required"))return!0;if(a(t).is("input")&&("checkbox"==c||"radio"==c)){var m=a(t).attr("name"),u=m?a("input[type=\""+c+"\"][name=\""+m+"\"]",o):null,_=m?a("input[type=\""+c+"\"][name=\""+m+"\"]:checked",o):null;return u&&u.length&&_&&_.length&&_.val()&&"0"!=_.val()?p._updateFieldState.call(t,!0,!1,"PLG_VPONEPAGECHECKOUT_INVALID"):p._updateFieldState.call(t,!1,!1),!0}switch(a(t).attr("required",!0),n){case"email_field":case"guest_email_field":l&&l.length&&(l=a.trim(l),a(t).val(l)),p.validateEmail.call(t,l)?(o.find("input#verify_email_field, input#reg_verify_email_field").trigger("change"),d._("AJAXVALIDATION")?((typeof p.cache.emails=="undefined"||"object"!==a.type(p.cache.emails))&&(p.cache.emails={}),p.cache.emails.hasOwnProperty(l)?p.cache.emails[l]?(p.removeFieldTip(t,!1),p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(t).addClass("hasFieldTip").attr("title",d.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),p.fieldTip(),p.showFieldTip(t)):p.ajax("checkemail",{beforeSend:function(){p._updateFieldState.call(t,null,!1,null)},data:"ctask=checkemail&email="+l,success:function(o){typeof o.valid=="undefined"||o.valid?(p.removeFieldTip(t,!1),p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),p.cache.emails[l]=!0):(p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(t).addClass("hasFieldTip").attr("title",d.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),p.fieldTip(),p.showFieldTip(t),p.cache.emails[l]=!1)}})):p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_EMAIL_INVALID");break;case"verify_email_field":case"reg_verify_email_field":l&&l.length&&(l=a.trim(l),a(t).val(l));var h=o.find("input#email_field").val();l==h&&l?p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");break;case"username_field":p.validateUsername.call(t,l)?d._("AJAXVALIDATION")?((typeof p.cache.usernames=="undefined"||"object"!==a.type(p.cache.usernames))&&(p.cache.usernames={}),p.cache.usernames.hasOwnProperty(l)?p.cache.usernames[l]?(p.removeFieldTip(t,!1),p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(t).addClass("hasFieldTip").attr("title",d.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),p.fieldTip(),p.showFieldTip(t)):p.ajax("checkusername",{beforeSend:function(){p._updateFieldState.call(t,null,!1,null)},data:"ctask=checkuser&username="+l,success:function(o){typeof o.valid=="undefined"||o.valid?(p.removeFieldTip(t,!1),p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),p.cache.usernames[l]=!0):(p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(t).addClass("hasFieldTip").attr("title",d.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),p.fieldTip(),p.showFieldTip(t),p.cache.usernames[l]=!1)}})):p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_USERNAME_INVALID");break;case"password_field":var g=o.find("input#password2_field"),v=o.find("#password-stregth"),y=o.find("#meter-status");g.removeClass("valid").siblings(".status").removeClass("valid"),p.removeFieldTip(t,!1),l&&p.validatePassword.call(t,l)?(p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),p.checkStrength.call(t,l)):(a("#password-stregth, #meter-status",o).removeAttr("class").addClass("invalid"),p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),v.text(""));break;case"password2_field":var h=o.find("input#password_field").val();l==h&&l?p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");break;case"name_field":default:l?p._updateFieldState.call(t,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):p._updateFieldState.call(t,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");}})},p.validateForm=function(){return a(this).find("input, select, textarea").trigger("blur"),!a(this).find(".invalid").length||(p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_REQUIRED_FIELDS_MISSING")),!1)},p.validateEmail=function(t){if(d._("DISABLELIVEVALIDATION"))return!0;return /^\w+[\+\.\w-]*@([\w-]+\.)*\w+[\w-]*\.([a-z]{2,10}|\d+)$/i.test(t)&&!(5>t.length)},p.validateUsername=function(t){if(d._("DISABLELIVEVALIDATION")||d._("DISABLEUSERNAMEVALIDATION"))return!0;return!!/^[a-zA-Z0-9]+$/.test(t)},p.validatePassword=function(t){if(d._("DISABLELIVEVALIDATION"))return!0;var e=this,n=!1;if(p.removeFieldTip(e,!1),a(this).removeAttr("title").removeClass("hasFieldTip"),0<=t.indexOf(" "))a(e).addClass("hasFieldTip").attr("title",d.JText._("COM_USERS_MSG_SPACES_IN_PASSWORD")),r=!0;else if(d._("PASSWORD_INTEGERS")||d._("PASSWORD_SYMBOLS")||d._("PASSWORD_UPPERCASE")){var l=t.match(/\d/g),i=t.match(/\W/g),s=t.match(/[A-Z]/g);0<d._("PASSWORD_INTEGERS")&&(!l||l.length<d._("PASSWORD_INTEGERS"))?(1==d._("PASSWORD_INTEGERS")?a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N_1",d._("PASSWORD_INTEGERS"))):a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N",d._("PASSWORD_INTEGERS"))),n=!0):0<d._("PASSWORD_SYMBOLS")&&(!i||i.length<d._("PASSWORD_SYMBOLS"))?(1==d._("PASSWORD_SYMBOLS")?a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N_1",d._("PASSWORD_SYMBOLS"))):a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N",d._("PASSWORD_SYMBOLS"))),n=!0):0<d._("PASSWORD_UPPERCASE")&&(!s||s.length<d._("PASSWORD_UPPERCASE"))&&(1==d._("PASSWORD_UPPERCASE")?a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N_1",d._("PASSWORD_UPPERCASE"))):a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N",d._("PASSWORD_UPPERCASE"))),n=!0)}else 0<d._("PASSWORD_LENGTH")&&t.length<d._("PASSWORD_LENGTH")&&(a(e).addClass("hasFieldTip").attr("title",d.JText.sprintf("COM_USERS_MSG_PASSWORD_TOO_SHORT_N",d._("PASSWORD_LENGTH"))),n=!0);return!n||(p.fieldTip(),p.showFieldTip(this),!1)},p.checkStrength=function(o){if(d._("DISABLELIVEVALIDATION"))return!0;var e=this,i=a(e).closest("form"),s=a("#password-stregth, #meter-status",i),n=i.find("#password-stregth"),l=i.find("#meter-status"),c=0;return 4>o.length?(s.removeAttr("class").addClass("short"),n.text(d.JText._("PLG_VPONEPAGECHECKOUT_TOO_SHORT")),p._updateFieldState.call(e,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),!1):void(4<o.length&&(c+=1),o.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(c+=1),o.match(/([a-zA-Z])/)&&o.match(/([0-9])/)&&(c+=1),o.match(/([!,%,&,@,#,$,^,*,?,_,~])/)&&(c+=1),o.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,",%,&,@,#,$,^,*,?,_,~])/)&&(c+=1),2>c?(s.removeAttr("class").addClass("weak"),n.text(d.JText._("PLG_VPONEPAGECHECKOUT_WEAK")),p._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):2==c?(s.removeAttr("class").addClass("good"),n.text(d.JText._("PLG_VPONEPAGECHECKOUT_GOOD")),p._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(s.removeAttr("class").addClass("strong"),n.text(d.JText._("PLG_VPONEPAGECHECKOUT_STRONG")),p._updateFieldState.call(e,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")))},p.guestcheckout=function(){var e=a("form#GuestUser"),t=a("button#proopc-task-guestcheckout",e),o=a("#proopc-guest-process",e);return p.ajax("guestcheckout",{dataType:"HTML",data:e.serialize(),beforeSend:function(){return!!p.validateForm.call(e)&&void(o.append(p.cache.spinner.el),t.attr("disabled",!0))},success:function(){o.find(".proopc-spinner").remove(),t.removeAttr("disabled"),p.setmsg("info",d.JText._("PLG_VPONEPAGECHECKOUT_EMAIL_SAVED"),!1),p.processCheckout({error:0}),p._triggerEvent(["guestcheckout.initiated"])},errorCallback:function(){o.find(".proopc-spinner").remove(),t.removeAttr("disabled"),p.setmsg("1","Some error occurred. Check console log for more details.")}}),!1},p.registerCheckout=function(){var e=a("form#UserRegistration"),t=a("button#proopc-task-registercheckout",e),o=a("#proopc-register-process",e);return p.ajax("register",{data:e.serialize()+"&ctask=register",beforeSend:function(){return!!p.validateForm.call(e)&&void(t.attr("disabled",!0),o.append(p.cache.spinner.el))},success:function(i){if(t.removeAttr("disabled"),o.find(".proopc-spinner").remove(),!("object"==a.type(i)&&i.msg))p._triggerEvent(["registration.success"]),p._onRegistrationSuccess(),"1"==i||1==i?(p.setmsg(3,d.JText._("COM_VIRTUEMART_REG_COMPLETE")),d._("RELOAD")?p._reload():setTimeout(function(){p.processCheckout(i)},100)):"string"===a.type(i)&&-1==i.indexOf("</head>")?p.setmsg(3,d.JText._("PLG_VPONEPAGECHECKOUT_REGISTRATION_NEED_LOGIN")):(p.setmsg(3,d.JText._("COM_VIRTUEMART_REG_COMPLETE")),d._("RELOAD")?p._reload():setTimeout(function(){p.processCheckout({error:0})},100));else if(1==i.error){if(p.setmsg("1",i.msg),i.reload)return p._reload(),!1;"undefined"!=typeof Recaptcha&&Recaptcha.reload(),p._triggerEvent(["registration.failed"])}else p.setmsg(3,i.msg),p._triggerEvent(["registration.success"]),p._onRegistrationSuccess(),i.stop||(d._("RELOAD")?p._reload():setTimeout(function(){p.processCheckout(i)},100))},errorCallback:function(){t.removeAttr("disabled"),o.find(".proopc-spinner").remove(),p.setmsg(1,"Error submiting registration form. Check console log for more details.")}}),!1},p._onRegistrationSuccess=function(){var e=a("form#UserRegistration"),t=a("input[name=\"proopc-method\"][value=\"login\"]"),o=a("#password-stregth",e),i=a("#meter-status",e);e[0].reset(),e.find("i.status").removeClass("valid").removeClass("invalid"),o.removeAttr("class").text(""),i.removeAttr("class"),t.length&&t.prop("checked",!0).trigger("change")},p.disableSubmit=function(){a("button#proopc-order-submit").attr("disabled","disabled").trigger("disabled")},p.enableSubmit=function(){var e=a("button#proopc-order-submit");p.cache.submitTimeout&&e.attr("disabled")&&clearTimeout(p.cache.submitTimeout),p.cache.submitTimeout=setTimeout(function(){e.removeAttr("disabled").trigger("enabled")},1e3)},p.disableMethodSelection=function(){a("input[name=\"virtuemart_paymentmethod_id\"][type=\"radio\"], input[name=\"virtuemart_shipmentmethod_id\"][type=\"radio\"]").attr("disabled","disabled")},p.enableMethodSelection=function(){a("input[name=\"virtuemart_paymentmethod_id\"][type=\"radio\"], input[name=\"virtuemart_shipmentmethod_id\"][type=\"radio\"]").removeAttr("disabled")},p.addloader=function(e){a(e).each(function(){a(this).find(".proopc-loader-overlay").length||(a(this).append("<div class=\"proopc-loader-overlay\"></div><div class=\"proopc-area-loader\"><span></span></div>"),a(".proopc-area-loader > span").html(p.cache.area_loader.el))}),p.disableSubmit(),a("body").addClass("proopc-loading")},p.removeloader=function(t){a(t).each(function(){a(".proopc-loader-overlay, .proopc-area-loader",this).remove()}),p.enableSubmit(),a("body").removeClass("proopc-loading")},p.addPageLoader=function(e){if(!a("#proopc-page-overlay",o).length){var t=a("<div />",{id:"proopc-page-overlay"}),i=a("<span />").append(p.cache.loader.el),s=a("<div />",{id:"proopc-page-spinner"}).append(i);a("body").append(t).append(s),a("#proopc-page-overlay").css({display:"block",height:a("body").outerHeight()}).animate({opacity:.7},300)}if(p.hasValue(e)){var n=a("#proopc-order-process");e=d.JText._(e,e),e&&(!n.length&&(n=a("<div />",{id:"proopc-order-process"}).appendTo("body")),n.text(e))}a("body").addClass("proopc-page-loading")},p.removePageLoader=function(){a("#proopc-page-overlay, #proopc-page-spinner, #proopc-order-process",o).remove(),a("body").removeClass("proopc-page-loading")},p.getToken=function(){return a("#formToken input:hidden").attr("name")+"=1"},p.pluginLoaded=function(e){return!!a.hasOwnProperty(e)||!!a.fn.hasOwnProperty(e)},p.setmsg=function(o,e,t){t=!("undefined"!=typeof t&&typeof t!==void 0)||t;var i=a("<button />",{type:"button",class:"close"}).attr("onclick","ProOPC.close(this);").html("&times;"),s=a("<span />").html(e),p=a("<div />",{class:"proopc-alert"}).append(i).append(s),l="proopc-warning-msg";"1"==o||"error"==o?l="proopc-error-msg":"2"==o||"warning"==o?l="proopc-warning-msg":"3"==o||"success"==o?l="proopc-success-msg":("4"==o||"info"==o)&&(l="proopc-info-msg"),p.addClass(l),a("#proopc-system-message").html(p),t&&a("html,body").animate({scrollTop:a("#proopc-system-message").offset().top-d._("SYSTEM_MESSAGE_OFFSET",100)},500)},p.initStateField=function(){if(!p.pluginLoaded("vm2front"))return console.warn("jQuery.vm2front plugin not loaded. Please enable \"Using the Script ajax Countries / Regions\" option in VirtueMart Configuration."),!1;var e=a("input#BTStateID").val(),t=a("input#STStateID").val(),o={dest:"#virtuemart_state_id_field",ids:e,prefiks:""};a("select#virtuemart_state_id_field").length&&a("select#virtuemart_country_id_field").vm2front("list",o),o.ids=t,o.prefiks="shipto_",a("select#shipto_virtuemart_state_id_field").length&&(o.dest="#shipto_virtuemart_state_id_field",a("select#shipto_virtuemart_country_id_field").vm2front("list",o))},p.processCheckout=function(t){if(p.hasValue(t)&&"object"===a.type(t)||(t={error:0,msg:[]}),t.error&&t.msg.length){var o="";return a.each(t.msg,function(a,e){o=o+"<div class=\"error-msg\">"+e+"</div>"}),p.setmsg(1,o),!1}p.ajax("procheckout",{dataType:"HTML",data:"task=procheckout",beforeSend:function(){p.addPageLoader("PLG_VPONEPAGECHECKOUT_PLEASE_WAIT"),a(".proopc-tooltip, .proopc-fieldtip").remove()},success:function(e){var t=a(e).find("div#ProOPC").html();t?(a("div#ProOPC").html(t),!d._("RELOAD")&&a("html, body").animate({scrollTop:a("#proopc-system-message").offset().top-100},500),p._triggerEvent(["checkout.finalstage"])):p._reload()},complete:function(){p.initStateField(),p.setStyle(),p.tooltip(),p.inputwidth(),p.selectwidth(),p.bindFormValidator(),p.productdetails(),p.enableSubmit(),p.defaultSP(),p.removePageLoader(),(typeof klarna!="undefined"||"undefined"!=typeof klarna)&&p.loadPaymentScripts(),p.loadShipmentScripts()}})},p.loginAjax=function(){var e=a("form#UserLogin"),t=a("button#proopc-task-loginajax",e),o=e.find("input[name=\"ctask\"]:hidden"),i=e.find("#proopc-login-process");return!!p.validateForm.call(e)&&("login"!=o.val()&&o.val("login"),p.ajax("login",{data:e.serialize(),dataType:"text",beforeSend:function(){i.append(p.cache.spinner.el),t.attr("disabled",!0)},success:function(a){i.find(".proopc-spinner").remove(),t.removeAttr("disabled");var e=!0;"1"==a||1==a?e=!0:(!a||-1==a.indexOf("</head>"))&&(e=!1),e?(p.setmsg("success",d.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_COMPLETED")),p._triggerEvent(["login.success"]),d._("RELOAD")?p._reload():p.processCheckout()):(p.setmsg("warning",d.JText._("JLIB_LOGIN_AUTHENTICATE")),p._triggerEvent(["login.failed"]))},errorCallback:function(){i.find(".proopc-spinner").remove(),t.removeAttr("disabled"),p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS"))}}),!1)},p.updateBTaddress=function(e){var t=a("form#EditBTAddres").serialize();e&&"virtuemart_country_id"==a(e).attr("name")&&p.on_load_bt_country_id&&a(e).val()!=p.on_load_bt_country_id&&(t+="&virtuemart_state_id="),p.ajaxManager.addReq({data:t+"&ctask=savebtaddress&"+p.getToken(),beforeSend:function(){p.disableSubmit()},success:function(t){p._triggerEvent(["checkout.bt.updated"]);var e=!1;t.vat_error&&t.msg?(p.setmsg("warning",t.msg),e=!0,p.updateVATFieldState(!1,t.info)):p.updateVATFieldState(!0,t.info),p.getshipmentpaymentcartlist(e)}},"updateBTaddress")},p.updateSTaddress=function(e){var t=a("form#EditSTAddres").serialize();e&&"shipto_virtuemart_country_id"==a(e).attr("name")&&p.on_load_st_country_id&&a(e).val()!=p.on_load_st_country_id&&(t+="&shipto_virtuemart_state_id="),p.ajaxManager.addReq({data:t+"&ctask=savestaddress&"+p.getToken(),beforeSend:function(){p.disableSubmit()},success:function(t){p._triggerEvent(["checkout.st.updated"]);var e=!1;t.vat_error&&t.msg?(p.setmsg("warning",t.msg),e=!0,p.updateVATFieldState(!1,t.info,"shipto_")):p.updateVATFieldState(!0,t.info,"shipto_"),p.getshipmentpaymentcartlist(e),typeof t.userinfo_id!=typeof void 0&&a("input#shipto_virtuemart_userinfo_id").val(t.userinfo_id)}},"updateSTaddress")},p.selectSTAddress=function(t){p.ajax("selectstaddress",{data:"ctask=selectstaddress&shipto_virtuemart_userinfo_id="+a(t).val(),beforeSend:function(){p.addloader("#proopc-st-address"),p.disableSubmit()},success:function(t){"object"!==a.type(t)&&(console.warn("Invalid data received"),console.log(t)),a("#proopc-st-address").html(t.editst),p.pluginLoaded("vm2front")?(0<t.stateid?a("input#STStateID").val(t.stateid):a("input#STStateID").val(""),a("#shipto_virtuemart_country_id_field").vm2front("list",{dest:"#shipto_virtuemart_state_id_field",ids:t.stateid,prefiks:"shipto_"})):console.warn("jQuery.vm2front plugin not loaded. Please enable \"Using the Script ajax Countries / Regions\" option in VirtueMart Configuration.");var e=!1;t.vat_error&&t.msg?(p.setmsg("warning",t.msg),e=!0,p.updateVATFieldState(!1,t.info,"shipto_")):p.updateVATFieldState(!0,t.info,"shipto_"),p.setStyle(),a("#shipto_virtuemart_state_id_field").trigger("liszt:updated"),p.inputwidth(),p.selectwidth(),p.removeloader("#proopc-st-address"),p._triggerEvent(["checkout.st.selected"]),p.getshipmentpaymentcartlist(e)}})},p.setst=function(t){t&&a(t).length&&(p.disableSubmit(),t.checked?p.ajax("btasst",{data:"ctask=btasst",beforeSend:function(){a(".proopc-st-address .edit-address").slideUp()},success:function(t){p._triggerEvent(["checkout.btasst"]);var e=!1;t.vat_error&&t.msg?(p.setmsg("warning",t.msg),e=!0,p.updateVATFieldState(!1,t.info,"shipto_")):p.updateVATFieldState(!0,t.info,"shipto_"),p.getshipmentpaymentcartlist(e)}}):p.ajax("btasst",{data:"ctask=btnotasst",beforeSend:function(){a(".proopc-st-address .edit-address").slideDown(),p.inputwidth(),p.selectwidth()},success:function(){p._triggerEvent(["checkout.btnotasst"]);var e=a("select#proopc-select-st");e.length&&0<e.val()?p.selectSTAddress(e[0]):p.updateSTaddress()}}))},p.getshipmentpaymentcartlist=function(e){e||a("#proopc-system-message").html(""),p.ajax("getshipmentpaymentcartlist",{beforeSend:function(){p.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),p.disableSubmit()},success:function(t){if("object"!==a.type(t))return p._reload(),!1;if(0==t.pqty)return p._reload(),!1;if(t.msg&&p.setmsg(t.msg_type,t.msg),a("#proopc-shipments").html(t.shipments),a("#proopc-payments").html(t.payments),a("#proopc-pricelist").html(t.cartlist),a("#proopc-cart-totalqty").text(t.pqty),a("#proopc-item-count").html(d.JText.plural("PLG_VPONEPAGECHECKOUT_N_ITEMS",t.pqty)),0<t.payment_scripts.length&&""!==t.payment_scripts[0])var e=t.payment_scripts;""!==t.payment_script[0]&&a.each(t.payment_script,function(o,i){a.getScript(i,function(){typeof e!="undefined"&&a.each(e,function(a,e){})})}),0<t.shipment_scripts.length&&""!==t.shipment_scripts[0]&&a.each(t.shipment_scripts,function(o,e){a("head").append("<script type=\"text/javascript\">"+e+"</script>")}),p._triggerEvent(["checkout.updated.shipmentpaymentcartlist"]),p.productdetails(),p.setStyle(),p.tooltip(),p.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),p.enableSubmit(),p.defaultSP()},errorCallback:function(){p.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),p.enableSubmit()}})},p.getcartlist=function(o,i){i||a("#proopc-system-message").html(""),p.ajax("getcartlist",{beforeSend:function(){p.addloader("#proopc-pricelist"),p.disableSubmit()},success:function(i){return"object"===a.type(i)?0==i.pqty?(p._reload(),!1):void(i.msg&&p.setmsg(i.msg_type,i.msg),a("#proopc-pricelist").html(i.cartlist),a("#proopc-cart-totalqty").text(i.pqty),a("#proopc-item-count").html(d.JText.plural("PLG_VPONEPAGECHECKOUT_N_ITEMS",i.pqty)),!p.hasValue(i.selected_shipment)&&a("form#proopc-shipment-form input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked").prop("checked",!1),!p.hasValue(i.selected_payment)&&a("form#proopc-payment-form input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked").prop("checked",!1),p._triggerEvent(["checkout.updated.cartlist"]),p.productdetails(),p.setStyle(),p.removeloader("#proopc-pricelist"),p.enableSubmit(),"undefined"!=typeof o&&o&&(t.location=o)):(p._reload(),!1)},errorCallback:function(){p.removeloader("#proopc-pricelist"),p.enableSubmit()}})},p.getcartsummery=function(e){e||a("#proopc-system-message").html(""),p.ajax("getcartsummery",{beforeSend:function(){p.addloader("#proopc-pricelist"),p.disableSubmit()},success:function(t){return"object"===a.type(t)?0==t.pqty?(p._reload(),!1):void(t.msg&&p.setmsg(t.msg_type,t.msg),a("#proopc-cart-totalqty").text(t.pqty),a("#proopc-item-count").html(d.JText.plural("PLG_VPONEPAGECHECKOUT_N_ITEMS",t.pqty)),a("#proopc-pricelist").html(t.cartsummery),p._triggerEvent(["checkout.updated.cartlist"]),p.setStyle(),p.removeloader("#proopc-pricelist"),p.enableSubmit()):(p._reload(),!1)},errorCallback:function(){p.removeloader("#proopc-pricelist"),p.enableSubmit()}})},p.getpayments=function(){p.ajax("getpaymentlist",{beforeSend:function(){p.addloader("#proopc-payments"),p.disableSubmit()},success:function(t){if("object"!==a.type(t))return p._reload(),!1;if(a("#proopc-payments").html(t.payments),0<t.payment_scripts.length&&""!==t.payment_scripts[0])var e=t.payment_scripts;""!==t.payment_script[0]&&a.each(t.payment_script,function(o,i){a.getScript(i,function(){"undefined"!=typeof e&&a.each(e,function(a,e){})})}),p._triggerEvent(["checkout.updated.paymentlist"]),p.setStyle(),p.tooltip(),p.removeloader("#proopc-payments"),p.enableSubmit(),p.defaultSP()},errorCallback:function(){p.removeloader("#proopc-payments"),p.enableSubmit()}})},p.getPaymentData=function(e){e=p.hasValue(e),a(".klarna_box_bottom").hide(),a(".vmpayment_cardinfo").removeClass("show").addClass("hide");var t=a("form#proopc-payment-form"),o=t.find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked");if(!o.length)return!1;var i=o.data("pmtype"),s=o.data("paypalproduct"),d="0",n="0";return s&&(i+=s),i&&a(".vmpayment_cardinfo."+i).length&&(a(".vmpayment_cardinfo."+i).removeClass("hide").addClass("show"),n="1"),"sisowideal"==i&&(n="1"),e&&(d="1",n="1"),o.hasClass("klarnaPayment")&&p.klarnaOpenClose.call(o[0]),p._triggerEvent(["prepare.data.payment",o[0]]),t.serialize()+"&ajax=1&savecc="+d+"&payment_data="+n},p.getShipmentData=function(){var e=a("form#proopc-shipment-form"),t=e.find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked");if(!t.length)return!1;var o=t.val(),i=t.data("usps"),s=t.data("ups"),d=t.data("upsrates");return a("#usps_name-"+o,e).length&&i&&a("#usps_name-"+o,e).val(i.service),a("#usps_rate-"+o,e).length&&i&&a("#usps_rate-"+o,e).val(i.rate),a("#ups_rate-"+o,e).length&&s&&a("#ups_rate-"+o,e).val(s.id),a("#upsrates-"+o,e).length&&d&&a("#upsrates-"+o,e).val(d),p._triggerEvent(["prepare.data.shipment",e[0],t[0]]),a("form#proopc-shipment-form").serialize()},p.loadPaymentScripts=function(){p.ajax("getpaymentscripts",{beforeSend:function(){p.addloader("#proopc-payments"),p.disableSubmit()},success:function(t){"object"===a.type(t)&&(a("#proopc-payments").html(t.payments),t.payment_scripts.length&&""!==t.payment_scripts[0]&&(payment_scripts=t.payment_scripts),t.payment_script.length&&""!==t.payment_script[0]&&a.each(t.payment_script,function(o,e){a.getScript(e,function(){"undefined"!=typeof payment_scripts&&a.each(payment_scripts,function(a,e){})})})),p.setStyle(),p.tooltip(),p.removeloader("#proopc-payments"),p.enableSubmit(),p.defaultSP()},errorCallback:function(){p.removeloader("#proopc-payments"),p.enableSubmit()}})},p.initPaymentScripts=function(){if("object"==typeof Virtuemart&&a("#paypal-button-container").length){typeof Virtuemart.onReadyPP==typeof void 0||a("#paypal-button-container").children().length||a("#paypal-button-container").data("pp.initiated")||(a("#paypal-button-container").html("").data("pp.initiated",!0),a("#paypal-button-login").html(""),a("#paypal-pui-container").html(""),Virtuemart.onReadyPP());var e=a("#proopc-payment-form input[name=\"virtuemart_paymentmethod_id\"]:checked");"object"==typeof vmPP&&e.length&&"paypal_checkout"===e.data("pmtype")&&"buttons"==e.data("pp")&&typeof vmPP.vmPPOrderId!=typeof void 0&&!vmPP.vmPPOrderId&&vmPP.bt_checkout_txt&&"0"!=vmPP.bt_checkout_txt?(a(".proopc-confirm-button-wrapper").addClass("disable-button"),a(".proopc-order-confirmation-notice").html(vmPP.bt_checkout_txt).removeClass("hide")):(a(".proopc-confirm-button-wrapper").removeClass("disable-button"),a(".proopc-order-confirmation-notice").addClass("hide"))}},p.loadShipmentScripts=function(){return!!a("form#proopc-shipment-form select").length&&void p.ajax("getshipmentscripts",{beforeSend:function(){p.addloader("#proopc-shipments"),p.disableSubmit()},success:function(t){"object"===a.type(t)&&(a("#proopc-shipments").html(t.shipments),t.shipment_scripts.length&&t.shipment_scripts[0]&&a.each(t.shipment_scripts,function(e,t){a("head, body").find("script[type=\"text/javascript\"]").each(function(){var e=a(this).attr("src");if("undefined"==typeof e||!1===e)return a(this).append(t),!1})})),p.setStyle(),p.tooltip(),p.removeloader("#proopc-shipments"),p.enableSubmit(),p.defaultSP()},errorCallback:function(){p.removeloader("#proopc-shipments"),p.enableSubmit()}})},p.defaultSP=function(t){var o,i=a("form#proopc-shipment-form"),s=a("form#proopc-payment-form"),n=d._("AUTOSHIPMENT"),l=d._("AUTOPAYMENT"),c="";t=typeof t!=typeof void 0&&t,0<=n&&!i.find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked").length&&i.find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]").length&&(0==n&&(n=i.find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:first").val()),o=i.find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"][value=\""+n+"\"]"),0<n&&o.length&&(o.attr("checked",!0),c+=p.getShipmentData()));var m=!1;0<=l&&!s.find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked").length&&s.find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]").length&&(0==l&&(l=s.find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:first").val()),o=s.find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"][value=\""+l+"\"]"),0<l&&o.length&&"exp"!=o.data("paypalproduct")&&(o.attr("checked",!0),c&&(c+="&"),c+=p.getPaymentData(),m=!0)),c&&""!==c?p.ajax("setdefaultsp",{data:"ctask=setdefaultsp&"+c,beforeSend:function(){p.addloader("#proopc-shipments, #proopc-payments"),p.disableSubmit()},success:function(o){return p.hasValue(o.selected_shipment)||a("form#proopc-shipment-form input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked").prop("checked",!1),p.hasValue(o.selected_payment)||a("form#proopc-payment-form input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked").prop("checked",!1),0<=l&&m&&p.hasValue(o.selected_payment)&&d._("RELOAD_AFTER_PAYMENT_SELECTION",0)?(window.location.reload(),!1):void(p.enableSubmit(),p.removeloader("#proopc-shipments, #proopc-payments"),typeof o.error!="undefined"&&"undefined"!=typeof o.error&&o.error?p._triggerEvent(["checkout.defaultsp.failed"]):(p._triggerEvent(["checkout.defaultsp.success"]),p.getcartlist()),!t&&p.initPaymentScripts())},errorCallback:function(){a("form#proopc-shipment-form input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked").prop("checked",!1),a("form#proopc-payment-form input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked").prop("checked",!1),p.enableSubmit(),p.removeloader("#proopc-shipments, #proopc-payments")}}):!t&&p.initPaymentScripts()},p.setshipment=function(){var e=p.getShipmentData(),t=a("form#proopc-shipment-form"),o=t.find("input[type=\"radio\"][name=\"virtuemart_shipmentmethod_id\"]:checked"),i=o.val();return!!e&&void p.ajax("setshipment",{data:"ctask=setshipments&"+e,beforeSend:function(){p.disableSubmit(),p.disableMethodSelection()},success:function(t){p.hasValue(t.selected)||(o.prop("checked",!1),t.selected=0),a("input#proopc-savedShipment:hidden").val(t.selected),t.error?(p.setmsg("2",t.msg),p._triggerEvent(["checkout.shipmentselection.failed",i]),p.getcartlist(!1,!0)):(p._triggerEvent(["checkout.shipmentselection.success",i]),p.getcartlist(),d._("RELOADPAYMENTS")&&p.getpayments())},errorCallback:function(){o.prop("checked",!1),p.enableSubmit()}})},p.setpayment=function(e){a(e).hasClass("btn-additional-klarna")&&a(e).closest(".proopc-klarna-payment").find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]").prop("checked",!0);var o=p.hasValue(e)&&a(e).length&&a(e).hasClass("btn-additional-klarna"),i=p.getPaymentData(o),s=a("form#proopc-payment-form"),l=s.find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked"),c=l.val();return!!i&&void p.ajax("setpayment",{data:"ctask=setpayment&"+i,async:!o,beforeSend:function(){p.disableSubmit(),p.disableMethodSelection()},success:function(i,s,t){if(t&&0<=t.getResponseHeader("content-type").indexOf("text/html")&&"undefined"!=typeof klarna){a("#proopc-order-submit").removeAttr("disabled"),a("<div />",{id:"proopc-temp",style:"display:none"}).appendTo("body"),a("#proopc-temp").append(i);a("#proopc-temp").find("div#system-message-container").html();p.setmsg(1,r),p.enableSubmit()}if(("string"===a.type(i)||"string"==typeof i)&&(i=a.parseJSON(i)),i.redirect=i.redirect?i.redirect:0,p.hasValue(i.selected)||l.prop("checked",!1),i.error)p.setmsg(2,i.msg),p._triggerEvent(["checkout.paymentselection.failed",c]),p.initPaymentScripts(),p.getcartlist(!1,!0);else if(i.redirect)p.setmsg(4,d.JText._("VMPAYMENT_PAYPAL_REDIRECT_MESSAGE")),p._triggerEvent(["checkout.paymentselection.successs",c]),p.initPaymentScripts(),p.getcartlist(i.redirect,!0);else if(o)p._triggerEvent(["checkout.paymentmethod.additionaldata.saved",c]),p.setmsg(4,d.JText._("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED")),p.enableSubmit();else{var n=!1;if(i.msg&&(l.hasClass("klarnaPayment")||!p.hasValue(i.selected))&&(p.setmsg(2,i.msg),n=!0),d._("RELOAD_AFTER_PAYMENT_SELECTION",0))return window.location.reload(),!1;p._triggerEvent(["checkout.paymentselection.successs",c]),p.initPaymentScripts(),p.getcartlist(!1,n)}},errorCallback:function(){l.prop("checked",!1),p.enableSubmit()}})},p.deleteproduct=function(t){return p.ajax("deleteproduct",{data:"ctask=deleteproduct&id="+a(t).data("vpid"),beforeSend:function(){p.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),p.disableSubmit()},success:function(o){return p._triggerEvent(["checkout.products.deleted",a(t).data("vpid")]),a("#proopc-system-message").html(""),a(".proopc-product-hover").addClass("hide"),0!=o.pqty&&o.pqty?void(0<a("input#proopc-cart-summery").length?p.getcartsummery():p.getshipmentpaymentcartlist(),a("body").trigger("updateVirtueMartCartModule")):(p._reload(),!1)},errorCallback:function(){p.enableSubmit()}}),!1},p.clearCart=function(t){a,t.preventDefault();var e=a("form#proopc-reload-form");return e.length?(a("<input />").attr("name","ctask").attr("type","hidden").val("clearcart").appendTo(e),e.submit()):window.location.href=d._("URI")+"&ctask=clearcart",!1},p.bindQuantityChange=function(){var e=a(this).val();if(e="string"==typeof e?e.replace(/\D/g,""):a(this).data("quantity"),a(this).val(e),d._("AUTO_UPDATE_QUANTITY"))return p.updateproductqty(this)},p.updateproductqty=function(){var e=!1;return(a(".proopc-qty-input").each(function(){if(a(this).data("quantity")!=a(this).val())return e=!0,!1}),!!e)&&(p.ajax("updateProductQty",{data:a("#proopc-carttable-form").serialize(),beforeSend:function(){p.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),p.disableSubmit()},success:function(t){return"object"===a.type(t)?(t.error?p.setmsg(2,t.msg):(p._triggerEvent(["checkout.products.updated",t.pqty]),t.msg?p.setmsg(2,t.msg):a("#proopc-system-message").html("")),a(".proopc-product-hover").addClass("hide"),0!=t.pqty&&t.pqty?void(0<a("input#proopc-cart-summery").length?p.getcartsummery(!0):p.getshipmentpaymentcartlist(!0),a("body").trigger("updateVirtueMartCartModule")):(p._reload(),!1)):(p._reload(),!1)},errorCallback:function(){p.enableSubmit()}}),!1)},p.savecoupon=function(){var t=a("input#proopc-coupon-code"),o=t.val(),i=t.data("default");return(a("#proopc-system-message").html(""),!o||o==i)?(p.setmsg(2,d.JText._("PLG_VPONEPAGECHECKOUT_COUPON_EMPTY")),!1):(p.ajax("setcoupon",{data:"ctask=setcoupon&coupon_code="+encodeURIComponent(o),beforeSend:function(){p.addloader("#proopc-coupon"),p.disableSubmit()},success:function(s){if("object"!==a.type(s))return p._reload(),!1;p._triggerEvent(["checkout.coupon.submitted",o,s.msg]);var e=s.error?s.error:"success";t.val(i),!s.wait&&s.msg&&p.setmsg(e,s.msg),p.removeloader("#proopc-coupon"),d._("RELOADALLFORCOUPON")?p.getshipmentpaymentcartlist(!0):p.getcartlist(null,!0),a("body").trigger("updateVirtueMartCartModule")},errorCallback:function(){p.setmsg(1,"An error has occurred while processing coupon code. See console log for more details."),p.removeloader("#proopc-coupon"),p.enableSubmit()}}),!1)},p.fieldGroups=[["title","first_name"],["middle_name","last_name"],["zip","city"],["shipto_middle_name","shipto_last_name"],["shipto_zip","shipto_city"]],p.inputwidth=function(){if(a("form#EditBTAddres").children().each(function(e){a(this).data("pos",e)}),a("form#EditSTAddres").children().each(function(e){a(this).data("pos",e)}),d._("GROUPING")&&"array"===a.type(p.fieldGroups)&&p.fieldGroups.length){var o,i;a.each(p.fieldGroups,function(e,t){"array"===a.type(t)&&2==t.length&&(o=a("."+t[0]+"-group"),i=a("."+t[1]+"-group"),o.length&&i.length&&o.data("pos")+1==i.data("pos")&&a("."+t[0]+"-group, ."+t[1]+"-group").wrapAll("<div class=\"proopc-row group-enabled\" />"))})}a(".proopc-bt-address input[type=\"text\"], .proopc-bt-address input[type=\"email\"], .proopc-st-address input[type=\"text\"], .proopc-st-address input[type=\"email\"], .proopc-additional-info input[type=\"text\"], .proopc-confirm-order input[type=\"text\"]").each(function(){a(this).css("width","");var e=a(this).parent(".inner").width();e&&a(this).width(e-15)}),a(".proopc-register-login input[type=\"text\"], .proopc-register-login input[type=\"password\"], .proopc-register-login input[type=\"email\"]").each(function(){a(this).css("width","");var e=a(this).parent(".proopc-input").width();e&&a(this).width(e-27)}),a(".proopc-register-login button").each(function(){a(this).css("width","");var e=a(this).parent(".proopc-input").outerWidth(!0);e&&a(this).width(e)});var s=a("#proopc-coupon .proopc-input-append").width(),e=a("#proopc-coupon").find("button.proopc-btn").outerWidth(!0);a("#proopc-coupon-code").width(s-e-20).css("margin-right",5)},p.selectwidth=function(){a(".proopc-bt-address select, .proopc-st-address select, .proopc-additional-info select, .proopc-confirm-order select").each(function(){a(this).css("width","");var e=a(this).parent(".inner").width();e&&a(this).outerWidth(e-3)}),a(".proopc-register-login select").each(function(){a(this).css("width","");var e=a(this).parent(".proopc-input").width();e&&a(this).outerWidth(e)})},p.productdetails=function(){return!!a(".proopc-cart-product").length&&(p.pluginLoaded("hoverIntent")?void a(".proopc-cart-product").each(function(){var e=this,t=a(e).data("details"),t=a("#"+t),o=a("table.proopc-p-info-table",t);a(e).hoverIntent({interval:100,sensitivity:6,timeout:100,over:function(){a(e).addClass("open"),a(o).width(a(e).width()),a(t).show().css("top",a(e).position().top).animate({opacity:1,top:a(e).position().top+a(e).height()},150,"linear")},out:function(){a(e).removeClass("open"),a(t).animate({opacity:0},100,"linear",function(){a(this).hide().css("top",0)})}})}):(console.warn("jQuery.hoverIntent plugin is not loaded. Product mouseover effect is being disabled to avoid errors."),!1))},p.tooltip=function(){var e=a.now(),t=a("<div />",{class:"tooltip-title"}),o=a("<div />",{class:"tooltip-body"}),i=a("<p />",{class:"proopc-tooltip"});a(".hover-tootip").each(function(s){var d=a(this).attr("title");d&&(a(this).attr("data-tiptext",d).removeAttr("title"),a(this).data("uniqueid","proopc-tip-"+e+"-key-"+s)),a(this).hover(function(s){s.stopPropagation();var e=a(this).data("uniqueid"),d=a(this).attr("data-tiptext"),p=null,n=null;if(e&&d){if(!a("#"+e).length){if(0<=d.indexOf("::")){var l=d.split("::");p=l[0],n=l[1]}else p=null,n=d;n&&(i.html("").attr("id",e),p&&i.append(t.html(p)),i.append(o.html(n)).appendTo("body"))}a("#"+e).addClass("show")}},function(){var e=a(this).data("uniqueid");e&&a("#"+e).length&&(a("#"+e).removeClass("show"),setTimeout(function(){a("#"+e).remove()},180))}).mousemove(function(t){var e=a(this).data("uniqueid");if(e&&a("#"+e).length){var o=a("#"+e),i=o.outerWidth(),s=o.outerHeight(),d=a(this).outerHeight();o.css({top:t.pageY-(s+d+2),left:t.pageX-i/2})}})})},p.fieldTip=function(){a(".hasFieldTip").hover(function(){a(this).attr("title")&&p.showFieldTip(this)},function(){p.removeFieldTip(this,!0)})},p.showFieldTip=function(e){var o=a(e),i="field-tip-"+a.now(),s=a(e).attr("title"),d=a(e).outerWidth(),n=a(e).offset();if(!o.data("tip")){o.data("tipText",s).data("tip","#"+i).removeAttr("title");var l=a("<p />",{id:i,class:"proopc-fieldtip",style:"margin: 0px;"}),c=a("<div />",{class:"fieldtip-body"}).html(s);l.html(c).css("visibility","hidden").appendTo("body");var m=l.outerWidth(),u=l.outerHeight(),_=n.top-(u+6),h=n.left+(d-m)/2;l.css({top:_,left:h,visibility:""}).fadeIn(200),a(t).resize(function(){var e;e&&clearTimeout(e),e=setTimeout(function(){d=o.outerWidth(),n=o.offset(),m=l.outerWidth(),u=l.outerHeight(),_=n.top-(u+6),h=n.left+(d-m)/2,l.css({top:_,left:h})},200)}),o.is(":hidden")&&p.removeFieldTip(e,!0),a("input[name=\"proopc-method\"][type=\"radio\"]").change(function(){p.removeFieldTip(e,!0)})}},p.removeFieldTip=function(e,t){var o=a(e),i=o.data("tip");i&&a(i).length&&(t&&o.attr("title",o.data("tipText")),o.data("tip",null),a(i).animate({opacity:0},200,function(){a(this).remove()}))},p.setStyle=function(){var e=0;a(".proopc-register > .proopc-inner, .proopc-login > .proopc-inner").css("min-height","").each(function(){a(this).outerHeight()>e&&(e=a(this).outerHeight())}),0<e&&a(".proopc-register > .proopc-inner, .proopc-login > .proopc-inner").css("min-height",e);var o=a("#ProOPC #dynamic_recaptcha_1 table:visible");if(o.length){var i=o.width(),s=o.closest(".proopc-input"),n=s.siblings(".proopc-input-group-level");s.width(i);var l=a(".proopc-register > .proopc-inner").width()-35;n.width(l-i)}var c,m;if(a("table.cart-summary.proopc-table-striped td").each(function(){c=a(this).text(),c=c?a.trim(c):"",m=a(this).html(),m=m?a.trim(m):"",(c&&c.length||m&&m.length)&&!a(this).is(":empty")||a(this).addClass("cell-empty")}),a("table.cart-summary.proopc-table-striped span.vm-price-desc").each(function(){c=a(this).text(),c=c?a.trim(c):"",m=a(this).html(),m=m?a.trim(m):"",(c&&c.length||m&&m.length)&&!a(this).is(":empty")||a(this).hide()}),a(".proopc-p-price > div, .proopc-taxcomponent > div, .proopc-p-discount > div").each(function(){a(this).is(":visible")&&a(this).css("display","inline")}),a(".proopc-login-message-cont").hover(function(){a(".proopc-logout-cont").removeClass("hide")},function(){a(".proopc-logout-cont").addClass("hide")}),a(".proopc-logout-cont").css("min-width",a(".proopc-loggedin-user").width()),a("[data-vpopc=\"redirect\"]").off("click").on("click",function(o){o.preventDefault();var e=a(this).attr("href"),e=e?e.replace("#",""):null,i=a(this).data("vphref");if(e){var s=a("<input />",{type:"hidden",name:"ctask",value:e});a("<form />",{action:d._("URI"),method:"post"}).html(s).appendTo("body").submit()}else i&&(t.location.href=i);return!1}),typeof t.bonusCartItemIds!="undefined"&&"undefined"!=typeof t.bonusCartItemIds&&a.each(t.bonusCartItemIds,function(o,e){if(!e.userCanUpdateQuantity){var t=a("input[data-vpid=\""+e.cartItemId+"\"]").parent(".proopc-input-append"),i=a(t).children("input[name=\"quantity\"]").val();a(t).hasClass("bonusSet")||(t.before(i),a(t).addClass("bonusSet")),t.hide(),t.parent().find("button.remove_from_cart").hide()}}),d._("STYLERADIOCHEBOX")){var u;a("#UserRegistration input[type=\"radio\"], #EditBTAddres input[type=\"radio\"], #EditSTAddres input[type=\"radio\"]").each(function(){a(this).parent("label").length||(a(this).css({width:"auto",float:"left"}),u=a(this).attr("id"),u&&a("label[for=\""+u+"\"]").addClass("proopc-radio-label"))}),a("#UserRegistration input[type=\"checkbox\"], #EditBTAddres input[type=\"checkbox\"], #EditSTAddres input[type=\"checkbox\"]").each(function(){a(this).parent("label").length||(a(this).css({width:"auto",float:"left",margin:"2px 0 0"}).parent(".proopc-input-append").css("padding-top","4px").siblings("br").remove(),u=a(this).attr("id"),u&&a("label[for=\""+u+"\"]").css({float:"left","padding-left":"10px","padding-right":"10px"}).insertAfter(this))})}if(a("#UserRegistration input[type=\"radio\"][required], #UserRegistration input[type=\"radio\"].required").parent(".proopc-input-append").addClass("proopc-input-append-radio"),a("#UserRegistration input[type=\"checkbox\"][required], #UserRegistration input[type=\"checkbox\"].required").parent(".proopc-input-append").addClass("proopc-input-append-checkbox"),a(".proopc-creditcard-info").each(function(){if(!a(this).closest(".vmpayment_cardinfo").length){var e=a(this).prevAll("input[name=\"virtuemart_paymentmethod_id\"]");if(e.length){var t=e.data("pmtype"),o=e.data("paypalproduct"),i=" hide";t&&(o&&(t+=o),e.is(":checked")&&(i=" show"),a(this).wrap("<span class=\"vmpayment_cardinfo additional-payment-info "+t+i+"\" />"))}}}),"undefined"!=typeof klarna&&"undefined"!=typeof klarna&&p.callKlarna(),a("#sisow_bank").closest("fieldset").length&&a("#sisow_bank").width(a("#sisow_bank").closest("fieldset").width()),a("#monthinstallments").closest(".proopc-row").length&&a("#monthinstallments").width(a("#monthinstallments").closest(".proopc-row").width()),a(".vmpayment_cardinfo").parent().is("div")&&a(".vmpayment_cardinfo").unwrap(),a("#ProOPC select[name=\"virtuemart_state_id\"], #ProOPC select[name=\"shipto_virtuemart_state_id\"]").on("liszt:updated",function(){var e,t=a(this).attr("id"),o=t&&a("select#"+t).length?a("select#"+t)[0]:this,i=a(o).closest("form"),s=a("select[name=\"virtuemart_country_id\"]",i),p=t?a("label[for=\""+t+"\"]"):null,n=p&&p.length?p.find(".asterisk"):null,l=a(o).find("optgroup"),c=a(o).find("option:first"),c=c.length&&!c.val()?c:null,m=d.JText._("COM_VIRTUEMART_LIST_EMPTY_OPTION"),u=a("input#STStateID").val();if(c)if(!c.data("selectText")){var m=c.text();c.data("selectText",m)}else var m=c.data("selectText");s.length||(s=a("select[name=\"shipto_virtuemart_country_id\"]",i)),e=s.val(),0<e&&l.each(function(){a(this).data("forcountry")&&a(this).data("forcountry")!=e?a(this).remove():a("option",this).length?a(this).data("forcountry",e):a(this).remove()}),a(o).removeClass("required"),l&&l.length?(a(o).removeAttr("readonly"),a(o).data("frequired")&&(a(o).attr("required",!0),n&&n.show()),c&&c.text(m),"shipto_virtuemart_state_id"==t&&0<u&&!a(o).val()&&l.find("option[value=\""+u+"\"]").length&&(l.find("option[value=\""+u+"\"]").attr("selected",!0),a(o).val(u))):(a(o).removeAttr("required").attr("readonly",!0),n&&n.hide(),c&&c.text(d.JText._("COM_VIRTUEMART_NONE"))),a(o).trigger("opcvalidate")}),d._("REMOVEUNNECESSARYLINKS")&&d._("EDITPAYMENTURI")&&(a("span.vmpayment a").each(function(){var e=a(this).closest("label").siblings(".vmpayment_cardinfo");if(e.length){a("<div />",{class:"proopc-payment-text"}).text(a(this).text()).prependTo(e);a(this).remove()}}),a("#ProOPC a").each(function(){a(this).attr("href")==d._("EDITPAYMENTURI")&&a(this).remove()})),d._("TOSFANCY")){if(!p.pluginLoaded("fancybox"))return console.warn("jQuery.fancybox plugin is not loaded. Terms of Service may not display properly."),!1;var _=a("div#proopc-tos-fancy"),s=_.parent(),h=a.easing&&a.easing.hasOwnProperty("elastic")?"elastic":"fade";a("[data-tos=\"fancybox\"]").fancybox({titlePosition:"inside",padding:0,showCloseButton:!1,centerOnScroll:!0,transitionIn:"fade",transitionOut:h,overlayOpacity:.8,overlayColor:"#000",onClosed:function(){a(this.href).length||(s.html(_),a("div#proopc-tos-fancy button.fancy-close").click(function(t){t.preventDefault(),a.fancybox.close()}))}}),a("div#proopc-tos-fancy button.fancy-close").click(function(t){t.preventDefault(),a.fancybox.close()})}d._("RELOAD")&&!a("#ProOPC").hasClass("loaded")&&a(".proopc-reload").length&&a("html,body").animate({scrollTop:a("#proopc-system-message").offset().top-100},500,function(){a("#ProOPC").addClass("loaded")});var g=a("input.klarnaPayment[type=\"radio\"]"),v=a("form#proopc-payment-form").find("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked");g.length&&(g.attr("onclick","return ProOPC.setpayment(this);").closest("table").addClass("proopc-klarna-payment"),v.length&&p.klarnaOpenClose.call(v[0])),a(".checkout-advertise .pp-credit a, .checkout-advertise .pp-express a").removeAttr("target")},p.isMobile=function(){var e=navigator.userAgent.toLowerCase(),t="PC";return(e.match(/android/i)?t="Android":e.match(/blackberry/i)?t="BlackBerry":e.match(/iphone/i)?t="iPhone":e.match(/ipad/i)?t="iPad":e.match(/ipod/i)?t="iPod":e.match(/opera mini/i)?t="Opera Mini":e.match(/iemobile/i)?t="IEMobile":e.match(/fban|fbav/i)&&(t="Facebook"),"PC"==t)?(a("html").addClass("device-is-pc").removeClass("device-is-handheld"),!1):(a("html").addClass("device-is-handheld").removeClass("device-is-pc"),t)},p.klarnaOpenClose=function(){if(!a(this).hasClass("klarnaPayment"))return!1;var e=this,t=a(e).closest(".proopc-klarna-payment"),o=a(".klarna_box_bottom_right .klarna_box_bottom_content .btn-additional-klarna",t),i=0;t.siblings().find(".klarna_box_bottom:visible").hide(),a(".proopc-klarna-payment input[name=\"klarna_paymentmethod\"]").attr("disabled",!0),a("input[name=\"klarna_paymentmethod\"]",t).removeAttr("disabled"),a(".klarna_box_bottom:hidden",t).css("opacity",0).show(),a("input[type=\"text\"]",t).width("auto"),a("input[type=\"text\"]:visible").each(function(){i=a(this).parent("div").width(),i&&a(this).css("max-width",i-13)}),a(".proopc-klarna-payment .klarna_box_bottom_input_combo").each(function(){a(this).children("div").width("100%")}),o.length||(o=a("<button />",{type:"button",class:"proopc-btn btn-additional-klarna",onclick:"return ProOPC.setpayment(this);",style:"margin-top: 15px;"}).text(d.JText._("COM_VIRTUEMART_SAVE")),a(".klarna_box_bottom_right .klarna_box_bottom_content",t).append(o)),a("div.klarna_box_bottom_title:visible, div.klarna_box_bottom_title:visible",t).removeAttr("style"),a("#box_klarna_consent_invoice:visible",t).parent("div").addClass("proopc-klarna-consent-container").width("auto"),a("#box_klarna_consent_part:visible",t).parent("div").addClass("proopc-klarna-consent-container").width("auto"),a(".klarna_box_bottom:visible",t).animate({opacity:1},300)},p.callKlarna=function(){var e=a("body"),t=a("#klarna_baloon").clone(),o=a("#klarna_blue_baloon").clone();if(a(".klarna_baloon, .klarna_blue_baloon",e).remove(),"undefined"!=typeof klarna&&"undefined"!=typeof klarna){if("undefined"!==klarna.doDocumentIsReady&&"function"===a.type(klarna.doDocumentIsReady)&&klarna.doDocumentIsReady(a(".klarna_box")),!klarna.unary_checkout){var i=a("#proopc-payment-form input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked");klarna.gChoice="",i.hasClass("klarnaPayment")&&(klarna.stype=i.data("stype"),klarna.gChoice=i.attr("id")),i.length&&p.klarnaOpenClose.call(i[0])}klarna.baloons_moved=!0}},p.getKlarnaForm=function(){var e=a("#proopc-payment-form input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked");if(!e.hasClass("klarnaPayment"))return!1;var t,o=e.closest("table"),i=o.find("*").serializeArray(),s=a("<form />");return i.push({name:"task",value:"setpayment"}).push({name:"view",value:"cart"}).push({name:"klarna_paymentmethod",value:selectedPayment.next("input").val()}),a.each(i,function(e,o){t=a("<input />",{type:"hidden",name:o.name,value:o.value}),s.append(t)}),s},p.setPreloaderState=function(e){var t=a("#proopc-preloader");"init"==e?a(t).addClass("proopc-started"):(setTimeout(function(){a(t).addClass("proopc-loaded").removeClass("proopc-started")},100),setTimeout(function(){a(t).remove()},600))},p.canCheckout=function(){if(!a("#ProOPC").length)return!1;var e=a("#ProOPC")[0];a(e).hasClass("emptyCart-view")?p.setPreloaderState("done"):(p._canCheckoutTask.call(e,!0),setInterval(function(){p._canCheckoutTask.call(e,!1)},9e5))},p._canCheckoutTask=function(e){var o=this;p.ajax("cancheckout",{beforeSend:function(){e&&p.setPreloaderState("init")},success:function(i){return"object"===a.type(i)?void(e&&p.setPreloaderState("done"),i.error?(a(o).removeClass("canCheckout"),i.reload&&p._reload()):a(o).addClass("canCheckout")):(a(o).removeClass("canCheckout"),t.location.reload(!0),!1)},errorCallback:function(){e&&p.setPreloaderState("done")}})},p.validateAllForms=function(){var e=a("form#EditBTAddres"),t=a("form#EditSTAddres"),o=a("#proopc-shipments"),i=a("#proopc-payments"),s=a("form#proopc-payment-form"),n=a("form#cartFormFields"),n=n&&n.length?n:a("form#checkoutForm"),l=n.find("input[name=\"tos\"][type=\"checkbox\"]"),c=a("#proopc-entry-single"),m=a("input#STsameAsBT[type=\"checkbox\"]").length&&a("input#STsameAsBT[type=\"checkbox\"]").is(":checked");if(c.length){var u=a("input[name=\"proopc-method\"][type=\"radio\"]",c),_=a("input[name=\"proopc-method\"][value=\"guest\"][type=\"radio\"]",c);if(!u.length)return p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_NEEDED")),!1;if(_.length)_.attr("checked",!0).trigger("change");else return p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_ONLY_REGISTERED_USER_CAN_CHECKOUT")),!1}var h=d._("EU_VAT_FIELD");if(h&&"string"===a.type(h)&&a("input#"+h+"_field").length&&a("input#"+h+"_field").hasClass("invalid"))return p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_EU_VAT_INVALID")),!1;var g=a("#ProOPC input#STsameAsBT[type=\"checkbox\"]");if(g.length&&!g.is(":checked")){var v="shipto_"+h;if(v&&"string"===a.type(v)&&a("input#"+v+"_field").length&&a("input#"+v+"_field").hasClass("invalid"))return p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_EU_VAT_INVALID")),!1}if(!p._validateAddressForms.call(e))return p.setmsg(1,d.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1;if(!m&&!p._validateAddressForms.call(t))return p.setmsg(1,d.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1;if(o.length&&!a("input[name=\"virtuemart_shipmentmethod_id\"][type=\"radio\"]",o).is(":checked"))return p.setmsg(1,d.JText._("COM_VIRTUEMART_CART_NO_SHIPMENT_SELECTED")),!1;if(i.length&&!a("input[name=\"virtuemart_paymentmethod_id\"][type=\"radio\"]",i).is(":checked")&&0>=a("input#vpopc_pp_express_selected").val())return p.setmsg(1,d.JText._("COM_VIRTUEMART_CART_NO_PAYMENT_SELECTED")),!1;var y=a("input[type=\"radio\"][name=\"virtuemart_paymentmethod_id\"]:checked",s);if(y.length&&y.hasClass("klarnaPayment")){var f,E=y.closest("table"),b=!1,S=[];a("input, select, textarea, .klarna_box_bottom_title",E).removeClass("invalid"),a("input:visible",E).not(":checkbox").each(function(){a(this).val()||(a(this).addClass("invalid").prev(".klarna_box_bottom_title").addClass("invalid"),f=a(this).prev(".klarna_box_bottom_title").text(),f&&S.push(f),b=!0)});var C=!1;if(a("select",E).each(function(){var e=a(this).val();(!e||""==parseInt(e)||0==parseInt(e)||isNaN(parseInt(e)))&&(a(this).addClass("invalid"),a(this).closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").addClass("invalid"),f=a(this).closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").text(),f&&!C&&(S.push(f),C=!0),b=!0)}),a("input[type=\"checkbox\"]",E).each(function(){a(this).is(":checked")||(a(this).addClass("invalid").next(".klarna_box_bottom_title").addClass("invalid"),S.push("Klarna: "+d.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS")),b=!0)}),a("input, select, textarea",E).change(function(){a(this).is("input")&&""!=a(this).val()&&a(this).removeClass("invalid").prev(".klarna_box_bottom_title").removeClass("invalid"),a(this).is("select")&&(""!=a(this).val()||"0"!=a(this).val())&&a(this).removeClass("invalid").closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").removeClass("invalid"),a(this).is("input[type=\"checkbox\"], input[type=\"radio\"]")&&a(this).is(":checked")&&a(this).removeClass("invalid").next(".klarna_box_bottom_title").removeClass("invalid")}),b&&S.length)return p.setmsg(1,d.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")+": "+S.join(", ")+"."),!1}if(l.length&&l.attr("required")&&!l.is(":checked")){var P=l.data("label"),P=P?P:d.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS");return p.setmsg(1,P),!1}return!!p._validateAddressForms.call(n)||(p.setmsg(1,d.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1)},p._validateAddressForms=function(){return a("input, select, textarea",this).each(function(){a(this).attr("id");a(this).off("opcvalidate").on("change opcvalidate",function(){if(a(this).attr("required")||a(this).hasClass("required")){a(this).attr("required",!0);var e=a(this).val(),t=a(this).attr("name"),o=a(this).closest("form"),i=a(this).attr("type");if(a(this).is("input")&&("checkbox"==i||"radio"==i)&&!a(this).hasClass("plugin-privacy")){var o=a(this).closest("form"),s=t?a("input[type=\""+i+"\"][name=\""+t+"\"]",o):null,d=t?a("input[type=\""+i+"\"][name=\""+t+"\"]:checked",o):null;s&&s.length&&d&&!d.length?p._updateAddressFieldState.call(this,!1):p._updateAddressFieldState.call(this,!0)}else e?p._updateAddressFieldState.call(this,!0):p._updateAddressFieldState.call(this,!1);if(e&&e.length&&("email"==t||"shipto_email"==t||"verify_email"==t)&&(e=a.trim(e),a(this).val(e),("email"==t||"shipto_email"==t)&&(p.validateEmail(e)?o.find("input[name=\"verify_email\"]").trigger("change"):p._updateAddressFieldState.call(this,!1)),"verify_email"==t)){var n=o.find("input[name=\"email\"]").val();n&&e!=n&&p._updateAddressFieldState.call(this,!1)}}else p._updateAddressFieldState.call(this,!0)})}).trigger("opcvalidate"),!(a(this).find("input.invalid").length||a(this).find("select.invalid").length||a(this).find("textarea.invalid").length)},p._updateAddressFieldState=function(e){var t=a(this).attr("id"),o=a(this).closest("form"),e=p.hasValue(e);e?(a(this).removeClass("invalid"),t&&a("label[for=\""+t+"\"]",o).length&&a("label[for=\""+t+"\"]",o).removeClass("invalid")):(a(this).addClass("invalid"),t&&a("label[for=\""+t+"\"]",o).length&&a("label[for=\""+t+"\"]",o).addClass("invalid"))},p.close=function(e){a(e).parent(".proopc-alert").remove()},p.checkForError=function(e){if(!(e&&"object"===a.type(e))){var t=this.hasOwnProperty("error")?this.error:null;p.ajaxManager.setContinuous(!1),t&&"function"===a.type(t)&&t.call(this)}else if(typeof e.error!="undefined"&&e.error){p.getcartlist(),p.removePageLoader(),p.enableSubmit();var o=d.JText._("PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS");typeof e.msg!="undefined"&&e.msg&&(o=e.msg),p.ajaxManager.setContinuous(!1),p.setmsg(1,o)}else return!0;return!1},p.updateVATFieldState=function(e,t,o){var i=d._("EU_VAT_FIELD");o&&i&&(i=o+i),i&&"string"===a.type(i)&&a("input#"+i+"_field").length&&(e?(a("input#"+i+"_field, label[for=\""+i+"_field\"]").removeClass("invalid"),"object"===a.type(t)&&t.hasOwnProperty(i)&&a("input#"+i+"_field").val(t[i])):a("input#"+i+"_field, label[for=\""+i+"_field\"]").addClass("invalid"))},p.commonError=function(){p.removePageLoader(),p.enableSubmit(),p.setmsg(1,d.JText._("PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS"))},p.joomla4Fallback=function(){window.Joomla.Modal=window.Joomla.Modal||{},window.Joomla.Modal.current="",window.Joomla.Modal.setCurrent=function(e){window.Joomla.current=e},window.Joomla.Modal.getCurrent=function(){return window.Joomla.current},a(".joomla-modal").addClass("in")},p.submitOrder=function(e,o){if(o=p.hasValue(o),!o||1==o){if(a("#proopc-system-message").html(""),!p.validateAllForms())return!1;p.ajaxManager.setContinuous(!0),p.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS"),p.disableSubmit();var i=a("#ProOPC input#STsameAsBT[type=\"checkbox\"]"),s=0;(!i.length||i.is(":checked"))&&(s=1),p.ajaxManager.addReq({data:"ctask=savebtaddress&stage=final&STsameAsBT="+s+"&"+a("form#EditBTAddres").serialize()+"&"+p.getToken(),beforeSend:function(){p.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS"),p.disableSubmit()},success:function(t){return!!p.checkForError.call(this,t)&&void(p._triggerEvent("checkout.bt.saved"),p.addPageLoader("PLG_VPONEPAGECHECKOUT_BILLING_ADDRESS_SAVED"),p.submitOrder(e,2))},error:p.commonError},"savebtaddress")}if(2==o){var i=a("#ProOPC input#STsameAsBT[type=\"checkbox\"]"),s=a("#proopc-hidden-confirm input[name=\"STsameAsBT\"]:hidden"),n=a("#proopc-hidden-confirm input[name=\"shipto\"]:hidden");if(n.removeAttr("disabled",!0),!i.length||i.is(":checked"))return a(s).val(1),a(n).val(0).attr("disabled",!0),p.submitOrder(e,3),!1;a(s).val(0),a(n).val(0),p.ajaxManager.addReq({data:"ctask=savestaddress&stage=final&"+a("form#EditSTAddres").serialize()+"&"+p.getToken(),beforeSend:function(){p.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_SHIPPING_ADDRESS"),p.disableSubmit()},success:function(t){return!!p.checkForError.call(this,t)&&void(a(n).val(t.userinfo_id),p._triggerEvent("checkout.st.saved"),p.addPageLoader("PLG_VPONEPAGECHECKOUT_SHIPPING_ADDRESS_SAVED"),p.submitOrder(e,3))},error:p.commonError},"savestaddress")}if(3==o&&(0<a("input#vpopc_pp_express_selected").val()?p.submitOrder(e,4):p.ajaxManager.addReq({data:"ctask=setpayment&ajax=1&savecc=1&finalise=1&"+a("form#proopc-payment-form").serialize()+"&"+p.getToken(),beforeSend:function(){p.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_CREDIT_CARD"),p.disableSubmit()},success:function(o,i,s){if(0<=s.getResponseHeader("content-type").indexOf("text/html")&&"undefined"!=typeof klarna){p.removePageLoader(),a("#proopc-order-process").remove(),a("<div />",{id:"proopc-temp",style:"display:none"}).appendTo("body"),a("#proopc-temp").append(o);var d=a("#proopc-temp").find("div#system-message-container").html();return p.setmsg(1,d),p.enableSubmit(),!1}return("string"==typeof o&&(o=a.parseJSON(o)),!!p.checkForError.call(this,o))&&void(!1==o.redirect?(p._triggerEvent("checkout.paymentmethod.saved"),p.addPageLoader("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED"),p.submitOrder(e,4)):t.location=o.redirect)},error:p.commonError},"setpayment")),4==o){var l=a("form#checkoutForm").serialize();a("form#cartFormFields").length&&(l+="&"+a("form#cartFormFields").serialize()),p.ajaxManager.addReq({data:"ctask=savecartfields&"+l,beforeSend:function(){p.disableSubmit()},success:function(t){return!!p.checkForError.call(this,t)&&void(p._triggerEvent("checkout.cartfields.saved"),p.submitOrder(e,5))},error:p.commonError},"savecartfields")}if(5==o&&p.ajaxManager.addReq({data:"ctask=verifycheckout",beforeSend:function(){p.addPageLoader("PLG_VPONEPAGECHECKOUT_VERIFYING_ORDER"),p.disableSubmit()},success:function(t){return p.checkForError.call(this,t)?void(p._triggerEvent("checkout.orderVerification.success"),p.submitOrder(e,6)):(p._triggerEvent("checkout.orderVerification.failed"),!1)},error:p.commonError},"verifycheckout"),6==o||"confirm"==o){p.addPageLoader("PLG_VPONEPAGECHECKOUT_PLACING_ORDER");var c=a("form#checkoutForm");if(!d._("ALL_OKAY",!0))return p.commonError(),!1;if(a("form#cartFormFields").length){a("#proopc-hidden-cart-fields").remove();var m=a("form#cartFormFields").children().clone(),u=a("<div></div>").attr("id","proopc-hidden-cart-fields").addClass("hide").append(m);a(c).append(u)}a(c).append(a("#proopc-hidden-confirm").html()),setTimeout(function(){a(c).submit()},100)}return!1},a(function(){return d._("READY",!1)?void(p.isMobile(),p.init(!0),p.initSpinner(),p.ajaxManager.run(),p.canCheckout(),p.setStyle(),p.inputwidth(),p.selectwidth(),p.bindFormValidator(),p.productdetails(),p.tooltip(),p.fieldTip(),p.defaultSP(!0),setTimeout(function(){p.joomla4Fallback()},200),a(t).on("proopc:saferesize",function(){p.setStyle(),p.inputwidth(),p.selectwidth()}),a(o).on("ajaxStop",function(){p.init(),p.enableMethodSelection()}),a(o).on("ajaxError",function(){p.enableMethodSelection()}),a(t).on("load",function(){p.setStyle()})):void console.error("VP One Page Checkout plugin is not ready.")}),t.addEventListener("orientationchange",function(){a(t).trigger("proopc:checkorientation")},!1),a(t).on("resize proopc:checkorientation",function(e){(e.type&&"proopc:checkorientation"===e.type||!p.isMobile())&&(p.cache.resizeTimeout&&clearTimeout(p.cache.resizeTimeout),p.cache.resizeTimeout=setTimeout(function(){a(t).trigger("proopc:saferesize",[e])},100))})}(ProOPC.jQuery,window,document,VPOPC,ProOPC);