/**
 * @package      VP One Page Checkout - Joomla! System Plugin
 * @subpackage   For VirtueMart 3+ and VirtueMart 4+
 *
 * @copyright    Copyright (C) 2012-2024 Virtueplanet Services LLP. All rights reserved.
 * @license      GNU General Public License version 2 or later; see LICENSE.txt
 * @authors      Abhishek Das <info@virtueplanet.com>
 * @link         https://www.virtueplanet.com
 */

!function(i){i(function(){var o=window.vpdk||{};o.showTimeout=null,o.hideTimeout=null,o.ajaxTimeout=null,o.modalBg=i('<div class="vpdk-modal-bg"></div>'),o.modalBg.appendTo("body"),o.show=function(e){o.showTimeout&&clearTimeout(o.showTimeout),i("body").addClass("vpdk-modal-open"),o.modalBg.addClass("vpdk-fade"),e.addClass("vpdk-fade"),o.showTimeout=setTimeout(function(){o.modalBg.addClass("vpdk-in"),e.addClass("vpdk-in")},20)},o.hide=function(e){o.hideTimeout&&clearTimeout(o.hideTimeout),i("body").removeClass("vpdk-modal-open"),o.modalBg.removeClass("vpdk-in"),e.removeClass("vpdk-in"),o.hideTimeout=setTimeout(function(){o.modalBg.removeClass("vpdk-fade"),e.removeClass("vpdk-fade")},150)},o.showMsg=function(e,a,d){var t=i('<div class="vpdk-alert vpdk-alert-'+(a=a||"error")+'"></div>');t.html(d),e.html(t)},o.hideMsg=function(e){e.text("")},o.showSystemMsg=function(e,a){var d=i('<div class="vpdk-alert vpdk-alert-'+(e=e||"error")+'"></div>');d.html(a),i("div#system-message-container").html(d),i("html,body").animate({scrollTop:i("div#system-message-container").offset().top-100},500)},o.hideSystemMsg=function(){i("div#system-message-container").text("")},i("[data-vpdk]").each(function(){var t=o;t.field=i(this),t.parentForm=i(this).closest("form"),t.actionURL=t.parentForm.attr("action"),t.id=t.field.attr("id"),t.btn=i("button#"+t.id+"-button"),t.clearBtn=i("button#"+t.id+"-clear-button"),t.revalBtn=i("button#"+t.id+"-reval-button"),t.enableBtn=i("button#"+t.id+"-enable-button"),t.tmpl=i("script#"+t.id+"-tmpl"),t.html=i(t.tmpl.html()),t.html.appendTo("body"),t.tmpl.remove(),t.hiddenField=i("input#"+t.id+"-hidden"),t.modal=i("#"+t.id+"-tmpl-modal"),t.form=t.modal.find("form"),t.msgBox=t.modal.find(".vpdk-modal-message"),t.unameField=t.form.find("input#"+t.id+"-tmpl-uname"),t.dlkField=t.form.find("input#"+t.id+"-tmpl-dlk"),t.confBtn=t.form.find("button#"+t.id+"-tmpl-button"),t.cancelBtn=t.form.find("button#"+t.id+"-tmpl-cancel"),t.closeBtn=t.modal.find("button.vpdk-modal-close"),t.url=t.form.data("action"),t.modalLoader=t.modal.find(".vpdk-modal-inner-bg"),t.infoNoaccess=t.field.siblings(".vpdk-info-box").find(".vpdk-info-noaccess"),t.infoValid=t.field.siblings(".vpdk-info-box").find(".vpdk-info-valid"),t.infoDefault=t.field.siblings(".vpdk-info-box").find(".vpdk-info-default"),t.btn.click(function(e){return e.preventDefault(),o.show(t.modal),o.hideSystemMsg(),!1}),t.clearBtn.click(function(e){return e.preventDefault(),t.field.val("***").trigger("change"),t.hiddenField.val("***").trigger("change"),o.hideSystemMsg(),!1}),t.field.change(function(){""==i(this).val()?(t.btn.removeClass("vpdk-show-edit"),t.clearBtn.addClass("vpdk-hide"),t.revalBtn.addClass("vpdk-hide"),t.infoValid.addClass("vpdk-hide"),t.infoNoaccess.addClass("vpdk-hide"),t.infoDefault.removeClass("vpdk-hide")):(t.btn.addClass("vpdk-show-edit"),t.clearBtn.removeClass("vpdk-hide"),t.revalBtn.removeClass("vpdk-hide"),"0"==i(this).data("vpdkaccess")?(t.infoNoaccess.removeClass("vpdk-hide"),t.infoDefault.addClass("vpdk-hide"),t.infoValid.addClass("vpdk-hide")):(t.infoDefault.addClass("vpdk-hide"),t.infoNoaccess.addClass("vpdk-hide"),t.infoValid.removeClass("vpdk-hide")))}),t.cancelBtn.click(function(e){o.hideMsg(t.msgBox),o.hide(t.modal),o.hideSystemMsg()}),t.closeBtn.click(function(e){o.hideMsg(t.msgBox),o.hide(t.modal),o.hideSystemMsg()}),t.enableBtn.click(function(){o.ajaxTimeout&&clearTimeout(o.ajaxTimeout);var e={cid:[t.enableBtn.data("extensionid")],task:"plugins.publish",option:"com_plugins"};e[t.enableBtn.data("token")]=1,o.ajaxTimeout=i.ajax({type:"POST",dataType:"HTML",url:t.enableBtn.data("root")+"/index.php?option=com_plugins",cache:!1,data:e,beforeSend:function(){t.enableBtn.attr("disabled",!0)},success:function(){window.location.href=t.enableBtn.data("root")+"/index.php?option=com_plugins&task=plugin.edit&extension_id="+t.enableBtn.data("extensionid")}})}),t.confBtn.click(function(){return o.hideMsg(t.msgBox),t.uname=t.unameField.val(),t.uname=t.uname?i.trim(t.uname):t.uname,t.dlk=t.dlkField.val(),t.dlk=t.dlk?i.trim(t.dlk):t.dlk,t.timeOut,t.uname?t.dlk?(o.ajaxTimeout&&clearTimeout(o.ajaxTimeout),void(o.ajaxTimeout=i.ajax({type:"GET",dataType:"JSON",url:t.url,cache:!1,data:{method:"validatedlk",uname:encodeURIComponent(t.uname),dlk:encodeURIComponent(t.dlk)},beforeSend:function(){t.modalLoader.addClass("vpdk-fade").addClass("vpdk-in")},success:function(e){return t.modalLoader.removeClass("vpdk-fade").removeClass("vpdk-in"),e?e.error?(o.showMsg(t.msgBox,"error",e.msg),!1):e.return.valid?(e.return.access?(o.showMsg(t.msgBox,"success",e.return.message),t.field.data("vpdkaccess","1").attr("data-vpdkaccess","1")):(o.showMsg(t.msgBox,"warning",e.return.message),t.field.data("vpdkaccess","0").attr("data-vpdkaccess","0")),t.field.val(e.return.dlk).trigger("change"),t.hiddenField.val(e.return.data).trigger("change"),t.timeOut&&clearTimeout(t.timeOut),void(t.timeOut=setTimeout(function(){o.hide(t.modal),t.form[0].reset(),o.hideMsg(t.msgBox)},500))):(o.showMsg(t.msgBox,"error",e.return.message),t.field.val("").trigger("change"),t.hiddenField.val("").trigger("change"),t.field.data("vpdkaccess","0").attr("data-vpdkaccess","0"),!1):(o.showMsg(t.msgBox,"error","Validation failed. Please check your internet connection. If problem persists please contact VirtuePlanet support."),!1)},error:function(e,a,d){console.log(e),console.log(a),console.log(d),t.modalLoader.removeClass("vpdk-fade").removeClass("vpdk-in"),o.showMsg(t.msgBox,"warning","Validation failed. Please check your internet connection. If problem persists please contact VirtuePlanet support.")}}))):(o.showMsg(t.msgBox,"error","Please provide a valid Download Key."),!1):(o.showMsg(t.msgBox,"error","Please provide a valid Username."),!1)}),t.revalBtn.click(function(){o.hideSystemMsg(),o.ajaxTimeout&&clearTimeout(o.ajaxTimeout),o.ajaxTimeout=i.ajax({type:"GET",dataType:"JSON",url:t.url,cache:!1,data:{method:"revalidatedlk",data:t.hiddenField.val()},beforeSend:function(){t.revalBtn.attr("disabled",!0)},success:function(e){return t.revalBtn.removeAttr("disabled"),e?e.error?(o.showSystemMsg("error",e.msg),t.field.val("").trigger("change"),t.hiddenField.val("").trigger("change"),t.field.data("vpdkaccess","0").attr("data-vpdkaccess","0"),!1):e.return.valid?(e.return.access?(o.showSystemMsg("success",e.return.message),t.field.data("vpdkaccess","1").attr("data-vpdkaccess","1")):(o.showSystemMsg("warning",e.return.message),t.field.data("vpdkaccess","0").attr("data-vpdkaccess","0")),t.field.val(e.return.dlk).trigger("change"),void t.hiddenField.val(e.return.data).trigger("change")):(o.showSystemMsg("error",e.return.message),t.field.val("").trigger("change"),t.hiddenField.val("").trigger("change"),t.field.data("vpdkaccess","0").attr("data-vpdkaccess","0"),!1):(o.showSystemMsg("error","Validation failed. Please check your internet connection. If problem persists please contact VirtuePlanet support."),!1)},error:function(e,a,d){console.log(e),console.log(a),console.log(d),t.revalBtn.removeAttr("disabled"),o.showSystemMsg("warning","Validation failed. Please check your internet connection. If problem persists please contact VirtuePlanet support.")}})}),"auto"==t.revalBtn.data("vpdkvalidate")&&t.revalBtn.trigger("click")})})}(jQuery);